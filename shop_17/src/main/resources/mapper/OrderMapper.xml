<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.qfedu.orders.dao.OrderMapper">
    <resultMap id="BaseResultMap" type="com.qfedu.orders.vo.OrdersVo">
        <result column="shop_name" property="shopName"/>
        <result column="gainname" property="uName"/>
        <association property="order" javaType="com.qfedu.orders.entity.Order">
            <id column="id" jdbcType="INTEGER" property="id"/>
            <result column="uid" jdbcType="INTEGER" property="uid"/>
            <result column="sho_id" jdbcType="INTEGER" property="shoId"/>
            <result column="oprice" jdbcType="DOUBLE" property="oprice"/>
            <result column="otime" jdbcType="DATE" property="otime"/>
            <result column="ostatus" jdbcType="TINYINT" property="ostatus"/>
            <result column="discuss_id" jdbcType="INTEGER" property="discussId"/>
        </association>
        <association property="address" javaType="com.qfedu.adrress.entry.Address">
            <result column="gainname" property="gainname"/>
            <result column="provice" property="provice"/>
            <result column="tel" property="tel"/>
            <result column="city" property="city"/>
            <result column="desadd" property="desadd"/>
        </association>
    </resultMap>
    <sql id="Base_Column_List">
    sys_orders.id, sys_orders.uid, sys_orders.sho_id, sys_orders.oprice, sys_orders.otime, sys_orders.ostatus, sys_orders.discuss_id
  </sql>
<!--    查询订单-->
    <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    select  shop_name,so.id, so.uid, so.sho_id, so.oprice, so.otime, so.ostatus, so.discuss_id ,sa.gainname
    from sys_orders so
    inner join shop_info si on so.sho_id = si.shop_id
    inner join sys_address sa on so.id = sa.oid where
    /*ostatus = 1 代表未评论  2已评论*/
    so.uid = #{id,jdbcType=INTEGER} and so.ostatus=1;
  </select>
    <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    delete from sys_orders
    where id = #{id,jdbcType=INTEGER}
  </delete>
    <insert id="insert" parameterType="com.qfedu.orders.entity.Order">
    insert into sys_orders (id, uid, sho_id, 
      oprice, otime, ostatus, 
      discuss_id)
    values (#{id,jdbcType=INTEGER}, #{uid,jdbcType=INTEGER}, #{shoId,jdbcType=INTEGER}, 
      #{oprice,jdbcType=DOUBLE}, #{otime,jdbcType=DATE}, #{ostatus,jdbcType=TINYINT}, 
      #{discussId,jdbcType=INTEGER})
  </insert>
    <update id="updateByPrimaryKeySelective" parameterType="com.qfedu.orders.entity.Order">
        update sys_orders
        <set>
            <if test="uid != null">
                uid = #{uid,jdbcType=INTEGER},
            </if>
            <if test="shoId != null">
                sho_id = #{shoId,jdbcType=INTEGER},
            </if>
            <if test="oprice != null">
                oprice = #{oprice,jdbcType=DOUBLE},
            </if>
            <if test="otime != null">
                otime = #{otime,jdbcType=DATE},
            </if>
            <if test="ostatus != null">
                ostatus = #{ostatus,jdbcType=TINYINT},
            </if>
            <if test="discussId != null">
                discuss_id = #{discussId,jdbcType=INTEGER},
            </if>
        </set>
        where id = #{id,jdbcType=INTEGER}
    </update>
    <update id="updateByPrimaryKey" parameterType="com.qfedu.orders.entity.Order">
    update sys_orders
    set uid = #{uid,jdbcType=INTEGER},
      sho_id = #{shoId,jdbcType=INTEGER},
      oprice = #{oprice,jdbcType=DOUBLE},
      otime = #{otime,jdbcType=DATE},
      ostatus = #{ostatus,jdbcType=TINYINT},
      discuss_id = #{discussId,jdbcType=INTEGER}
    where id = #{id,jdbcType=INTEGER}
  </update>
</mapper>